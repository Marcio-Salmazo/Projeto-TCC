"use strict";(()=>{var S=M(),l=new URL(window.location.href),s=B(window._crucible?.config),z=window.location.search.includes("debug=true"),w=[];function A(e){let n=window.assertive?.analytics?.custom||{};u({ad_unit:e.adUnitPath,bid_id:"",bid_src:e.preBidWon?"prebid":"gam",bidder:e.highestPreBid_partner,cpm:e.highestPreBid,creative_id:"",duration:0,media_type:b(e.mediaType),type:"ad_impression",vast_url:"",vast_xml:""},Object.keys(n).filter(i=>n[i]).reduce((i,r)=>(i[r]=n[r]||"",i),{}))}function P(e,n){if(window.apstag?.debug){let i=window.apstag.debug("getState");if(!i)return;let r=i.slotBids[e]||[];return r.length===0?void 0:n?r.find(o=>o.bidConfig.amzniid===n):r[r.length-1]}}function g(e,n,i){return typeof e===n?e:i}function c(e,...n){z&&console[e]("%cSC","padding: 1px 5px; border-radius: 3px; font-family: Consolas; color: white; background: rgb(131,58,180); background: linear-gradient(90deg, rgba(131,58,180,1) 0%, rgba(253,29,29,1) 50%, rgba(252,176,69,1) 100%);","scribe:",...n)}function B(e){let n={gamLineItemMap:{},noAdxFill:!1,noBanner:!1,organizationId:"",...L()};if(typeof e!="object"||e===null)return n;let i=e;return{gamLineItemMap:g(i.gamLineItemMap,"object",n.gamLineItemMap),noAdxFill:g(i.noAdxFill,"boolean",n.noAdxFill),noBanner:g(i.noBanner,"boolean",n.noBanner),organizationId:g(i.organizationId,"string",n.organizationId)}}function b(e){switch(e){case"v":case"video":return"video";default:return"banner"}}function y(...e){for(let n of e)n()}function L(){let e=document.currentScript;if(!e)return{};let n=new URL(e.src);return{noAdxFill:!!n.searchParams.get("noAdxFill"),noBanner:!!n.searchParams.get("noBanner"),organizationId:n.searchParams.get("organizationId")||""}}function u(e,n={}){let i={...e,custom:n,organization_id:s.organizationId,session_id:S,timestamp:Date.now(),transaction_id:crypto.randomUUID(),url:e.url||window.location?.href||document.location?.href,utm_campaign:l.searchParams.get("utm_campaign")||"",utm_content:l.searchParams.get("utm_content")||"",utm_medium:l.searchParams.get("utm_medium")||"",utm_source:l.searchParams.get("utm_source")||""};c("info","tracking event",i),w.push(i)}var x="_scribe",I=`${x}/session`;function M(){let e=localStorage.getItem(I);if(e)return e;let n=crypto.randomUUID();return localStorage.setItem(I,n),n}function U(){if(!s.organizationId)throw new Error("Missing organization id in configuration");if(window._crucible?.loaded)return;window.assertiveQueue=window.assertiveQueue||[],window._crucible=window._crucible||{loaded:!0,q:[],track:u},window.pbjs=window.pbjs||{que:[]},window.pbjs.que=window.pbjs.que||[],window._crucible.loaded=!0,window._crucible.track=u,window.googletag=window.googletag||{cmd:[]},c("info","read in configuration",s),window.addEventListener("beforeunload",p,{capture:!0}),window.addEventListener("visibilitychange",p,{capture:!0}),window.setInterval(p,120*1e3),u({type:"page_view"});let e=!1;document.readyState!=="complete"&&window.addEventListener("load",()=>{e=!0}),window.addEventListener("popstate",()=>{e&&u({type:"page_view"})},{capture:!0}),window.history.pushState=new Proxy(window.history.pushState,T()),window.history.replaceState=new Proxy(window.history.replaceState,T()),s.noBanner||(window.assertive=window.assertive||{},window.assertive.logCustomImpression=window.assertive.logCustomImpression||A,window.googletag.cmd.push(()=>{googletag.pubads()?.addEventListener("slotRenderEnded",R)}));let n=Array.isArray(window._crucible?.q)?window._crucible.q:[];window._crucible.q={push:y},s.noBanner||(window.assertiveQueue=window._crucible.q),y(...n)}function T(){return{apply(e,n,i){let r=window.location.href,o=r,d=i[2];return typeof d=="string"?o=new URL(d,r).toString():d instanceof URL&&(o=d.toString()),o.startsWith(window.location.origin)&&u({type:"page_view",url:o}),e.apply(n,i)}}}function R(e){let{isBackfill:n,isEmpty:i,slot:r}=e,o=r.getTargetingMap(),d=r.getAdUnitPath(),f=r.getHtml(),k=r.getSlotElementId(),_=o.hb_adid?.[0],v=e.lineItemId&&window._crucible?.config?.gamLineItemMap&&e.lineItemId in window._crucible.config.gamLineItemMap;c("info","received slot render ended event",d,_,o,e);let h=(f.includes("apstag.renderImp(document,")?"amazon":"")||(!i&&!n&&!v&&_?"prebid":"")||"gam",t={bid_id:"",bidder:"",cpm:0,creative_id:"",media_type:"banner"};switch(h){case"amazon":{let m=o.amzniid?.[0],a=P(k,m),E=o.amznbid;c("info","amazon won with bid",E,a),t.cpm=0,a&&(t.bidder=a.bidConfig.amznp||"unknown",t.creative_id=a.bidConfig.crid||"",t.bid_id=a.bidConfig.amznbid||"",t.media_type=b(a.bidConfig.mediaType));break}case"gam":{if(t.bidder=n?"google":"direct",t.cpm=v?s.gamLineItemMap[e.lineItemId||0]:.01,t.bid_id=`${e.advertiserId}-${e.campaignId}-${e.lineItemId}-${e.creativeId}`,t.creative_id=e.creativeId?.toString()||"",t.media_type="banner",s.noAdxFill&&t.bidder==="google"){c("error","invalid configuration, no adx fill set but found adx backfill",t);return}break}case"prebid":{let m=o.hb_adid?.[0],a={adId:o.hb_adid?.[0],bidder:o.hb_bidder?.[0],cpm:Number(o.hb_pb?.[0]),creativeId:o.hb_crid?.[0],mediaType:o.hb_format?.[0]};c("info","prebid won with bid",m,a),t.cpm=a.cpm||0,t.bidder=a.bidder||"unknown",t.creative_id=a.creativeId||"",t.bid_id=a.adId||"",t.media_type=b(a.mediaType);break}default:break}let C={...t,ad_unit:d,bid_src:h,duration:0,type:"ad_impression",vast_url:"",vast_xml:""};i||u(C)}function p(){let e=w;if(w=[],e.length>0){c("info","pushing events to crucible");let n=new TextEncoder;navigator.sendBeacon("https://crucible.adforge.io/meld/api/events",n.encode(JSON.stringify({events:e,sendTimestamp:Date.now()})))}}U();})();
