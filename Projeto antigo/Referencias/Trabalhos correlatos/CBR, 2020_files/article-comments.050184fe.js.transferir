(()=>{"use strict";var e={925(e,t,n){n.d(t,{A:()=>d});var i=n(3768);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}function r(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=o(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}const d=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ajaxRequest=!1,this.handleAccountVerificationClick=this.handleAccountVerificationClick.bind(this),this.handleCloseButtonClick=this.handleCloseButtonClick.bind(this)},t=[{key:"hideSuccessVerificationMsg",value:function(){var e=document.getElementById("account-verification-popup-success-msg-new");e&&e.classList.add("is-hidden")}},{key:"hideErrorVerificationMsg",value:function(){var e=document.getElementById("account-verification-popup-error-msg-new");e&&e.classList.add("is-hidden")}},{key:"displaySuccessVerificationMsg",value:function(e){var t=document.getElementById("account-verification-popup-success-msg-new"),n=document.getElementById("accountVerificationPopupCloseButton");e&&(t.firstChild.innerHTML=e),t.classList.remove("is-hidden"),setTimeout(function(){t.classList.add("is-hidden"),n&&n.click()},4e3)}},{key:"displayErrorVerificationMsg",value:function(e){var t=document.getElementById("account-verification-popup-error-msg-new"),n=document.getElementById("accountVerificationPopupCloseButton");e&&(t.firstChild.innerHTML=e),t.classList.remove("is-hidden"),setTimeout(function(){t.classList.add("is-hidden"),n&&n.click()},4e3)}},{key:"handleVerificationResponse",value:function(e){this.hideSuccessVerificationMsg(),this.hideErrorVerificationMsg();var t=e.status,n=e.message;"success"===t?this.displaySuccessVerificationMsg(n):this.displayErrorVerificationMsg(n),this.ajaxRequest=!1}},{key:"handleVerifyAccount",value:function(){var e=this;window.isUserLoggedIn&&(this.ajaxRequest&&this.ajaxRequest.abort(),this.ajaxRequest=new XMLHttpRequest,this.ajaxRequest.open("GET","/verify-email/",!0),this.ajaxRequest.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this.ajaxRequest.onreadystatechange=function(){4===e.ajaxRequest.readyState&&e.ajaxRequest.response&&e.handleVerificationResponse(JSON.parse(e.ajaxRequest.response))},this.ajaxRequest.send())}},{key:"injectAccountVerificationPopup",value:function(){var e=document.getElementById("account-verification-popup-container");if(!window.accountVerificationContainerInjected&&!e){var t=window.accountVerificationPopupHtml.trim("&quot;").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&").replace(/(^"|"$)/g,"").replaceAll("loginForm","loginPopup");document.body.insertAdjacentHTML("beforeend",t),window.accountVerificationContainerInjected=!0}}},{key:"showAccountVerificationPopup",value:function(){this.injectAccountVerificationPopup();var e=document.getElementById("account-verification-popup-container"),t=document.getElementById("account-verification-popup-message");if(t&&(t.innerHTML="Please verify your email address to unlock additional features on your account."),e){var n=e.getAttribute("data-style-path-url"),o="true"===e.getAttribute("data-style-injected");n&&!o?(0,i.tW)(n,function(){e.setAttribute("data-style-injected","true"),e.classList.add("is-visible")}):e.classList.add("is-visible")}this.addAccountVerificationPopupEventListeners()}},{key:"addAccountVerificationPopupEventListeners",value:function(){var e=document.getElementById("accountVerificationPopupCloseButton"),t=document.getElementById("accountVerificationPopupSubmitButton");e&&!e.isAlreadyAttached&&(e.isAlreadyAttached=!0,e.removeEventListener("click",this.handleCloseButtonClick),e.addEventListener("click",this.handleCloseButtonClick)),t&&!t.isAlreadyAttached&&(t.isAlreadyAttached=!0,t.removeEventListener("click",this.handleAccountVerificationClick),t.addEventListener("click",this.handleAccountVerificationClick))}},{key:"handleAccountVerificationClick",value:function(e){return e.preventDefault(),e.stopPropagation(),this.handleVerifyAccount(),!1}},{key:"handleCloseButtonClick",value:function(e){return e.preventDefault(),e.stopPropagation(),document.getElementById("account-verification-popup-container").classList.remove("is-visible"),this.hideSuccessVerificationMsg(),this.hideErrorVerificationMsg(),!1}}],t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}()},3768(e,t,n){function i(e){return!e||""==e.replace(/\s|\n|\r/gm,"")}function o(e){var t=document.createElement("template");return t.innerHTML=e,Array.from(t.content.childNodes).find(function(e){return e.nodeType!==Node.TEXT_NODE})}function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};r([e]).then(function(){t()})}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Promise.allSettled(e.map(function(e){return new Promise(function(t){var n=function(){return t()};if(!e)return n();var i=document.head.querySelector('link[href="'.concat(e,'"]'));if(i)return"complete"===i.readyState||"loaded"===i.readyState?n():(i.addEventListener("load",n),void i.addEventListener("error",n));var o=document.createElement("link");o.setAttribute("rel","stylesheet"),o.setAttribute("href",e),o.addEventListener("load",n),o.addEventListener("error",n),document.head.appendChild(o)})}))}n.d(t,{CC:()=>o,lS:()=>i,tW:()=>a})}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,n),a.exports}function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=document.querySelector('script[src="'.concat(e,'"]'));if(i)return t.apply(i),i;var o=document.createElement("script");if(o.onload=t,o.src=e,n.defer&&(o.defer=!0),document.body)document.body.appendChild(o);else var a=setInterval(function(){o.parentElement&&clearInterval(a),document.body&&(clearInterval(a),document.body.appendChild(o))},1);return o}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}function r(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=o(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var d=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t._swipeHandler&&t._swipeHandler.detach(),this._boundEvents={},this.element=t,this.swipeStartAt=0,this.deltaX=0,this.deltaY=0,this.options=Object.assign({maxSwipeTime:500,threshold:80,onSwipeRight:function(){},onSwipeLeft:function(){},onSwipeUp:function(){},onSwipeDown:function(){}},n),this._init()},(t=[{key:"_init",value:function(){this._boundEvents.touchstart=this._handleTouchStart.bind(this),this._boundEvents.touchend=this._handleTouchEnd.bind(this),this._boundEvents.touchmove=this._handleTouchMove.bind(this),this.element.addEventListener("touchstart",this._boundEvents.touchstart),this.element.addEventListener("touchmove",this._boundEvents.touchmove),this.element.addEventListener("touchend",this._boundEvents.touchend),this.element._swipeHandler=this}},{key:"_handleTouchStart",value:function(e){this.deltaX=0,this.deltaY=0,this.startX=e.touches[0].clientX,this.startY=e.touches[0].clientY,this.swipeStartAt=Date.now()}},{key:"_handleTouchMove",value:function(e){this.deltaX=e.touches[0].clientX-this.startX,this.deltaY=e.touches[0].clientY-this.startY}},{key:"_handleTouchEnd",value:function(e){Date.now()-this.swipeStartAt<this.options.maxSwipeTime&&(Math.abs(this.deltaX)>this.options.threshold&&(this.deltaX>0?this.options.onSwipeRight():this.options.onSwipeLeft()),Math.abs(this.deltaY)>this.options.threshold&&(this.deltaY>0?this.options.onSwipeDown():this.options.onSwipeUp())),this.deltaX=0,this.deltaY=0}},{key:"detach",value:function(){this.element.removeEventListener("touchstart",this._boundEvents.touchstart),this.element.removeEventListener("touchmove",this._boundEvents.touchmove),this.element.removeEventListener("touchend",this._boundEvents.touchend),this.element._swipeHandler=null}}])&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();window.SwipeHandler=d;var s=n(3768),l=n(925);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){w(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function w(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=c(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=c(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==c(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"thread",i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(o=m(m({},{mode:"popup",idParent:null,className:"popup",triggeredFrom:"thread",gaEventCategory:"thread",showCloseButton:!0}),o),!e){if(window.dispatchEvent(new CustomEvent("valnet_ui_event:user_not_logged_in")),t){if(!window.ValnetLogin)return console.error("ValnetLogin is not defined."),!1;var d=new ValnetLogin(o);d.showLoginForm(d),i&&(location.hash=n)}return"function"==typeof a&&a(),!1}if(!e.isVerified){if(window.dispatchEvent(new CustomEvent("valnet_ui_event:user_not_verified")),t)(new l.A).showAccountVerificationPopup();return"function"==typeof r&&r(),!1}return!0}function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,f(i.key),i)}}function f(e){var t=function(e,t){if("object"!=g(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=g(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==g(t)?t:t+""}var h=function(){return function(e,t,n){return t&&v(e.prototype,t),n&&v(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=Object.assign({html:"",cls:Object.assign([],n&&n.cls||[]),openCallback:function(){},closeCallback:function(){}},n),this._isClosing=!1,this._isClosed=!1,this.modal=document.createElement("dialog"),this.modal.innerHTML=this.options.html;for(var i=0;i<this.options.cls.length;i++)this.modal.classList.add(this.options.cls[i]);this.modal.addEventListener("close",function(){t._onClosed()}),this.modal.addEventListener("click",function(e){e.target===t.modal&&t.close()})},[{key:"getElement",value:function(){return this.modal}},{key:"open",value:function(){this._isClosing=!1,this._isClosed=!1,document.body.appendChild(this.modal),this.modal.showModal(),this.options.openCallback(this,this.modal)}},{key:"close",value:function(){if(!this._isClosing&&!this._isClosed){this._isClosing=!0;try{this.modal.close()}catch(e){this._onClosed()}}}},{key:"_onClosed",value:function(){if(!this._isClosed){this._isClosed=!0,this._isClosing=!1;try{this.options.closeCallback(this,this.modal)}finally{this.modal&&this.modal.parentNode&&this.modal.parentNode.removeChild(this.modal)}}}}])}();function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,a,r,d=[],s=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(i=a.call(n)).done)&&(d.push(i.value),d.length!==t);s=!0);}catch(e){l=!0,o=e}finally{try{if(!s&&null!=n.return&&(r=n.return(),Object(r)!==r))return}finally{if(l)throw o}}return d}}(e,t)||I(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach(function(t){S(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function S(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=y(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=y(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==y(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=I(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,d=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return r=e.done,e},e:function(e){d=!0,a=e},f:function(){try{r||null==n.return||n.return()}finally{if(d)throw a}}}}function I(e,t){if(e){if("string"==typeof e)return A(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}var T=!1;window.enableCommentSubmit=!0;function B(e){return e.replace(/<\/?[^>]+(>|$)/g,"")}function q(e){return function(e){var t=e,n=z();if(!n)return t;var i=document.createElement("div");i.setAttribute("hidden",!0),i.innerHTML=t,document.body.append(i);for(var o=i.querySelectorAll(".mention"),a=0;a<o.length;a++){var r=o[a],d=r.getAttribute("data-value");if(d){for(var s=void 0,l=0;l<n.length;l++)if(n[l].value+""==d+""){s=n[l];break}if(!s){var c=H.exec(d);if(H.lastIndex=0,!c||c.length<3)continue;s={idPublic:c[2],displayName:c[1]}}var u=document.createElement("span");u.innerHTML=F(s),r.replaceWith(u.firstChild)}}return t=i.innerHTML,i.remove(),t}(e=function(e){var t=document.createElement("div"),n=e;t.innerHTML=n,t.setAttribute("hidden",!0),document.body.appendChild(t);for(var i=t.querySelectorAll("span.ql-emojiblot"),o=0;o<i.length;o++){var a=i[o].outerHTML,r=i[o].innerText;n=n.replace(a,r)}return t.remove(),n}(e))}function M(e,t){if(!(0,s.lS)(t)&&e){if(e.closest('[data-is-quick-rating-widget="true"]'))return;var n=new h({html:'\n            \x3c!--<button class="btn-rating-popup icon i-close icon-only" data-is-close="true"><span>Close</span></button>--\x3e\n            '.concat(t,"\n            "),cls:["post-rating-popup"],openCallback:function(e){var t=e.getElement();window.initializeInteractives&&window.initializeInteractives();t.querySelector('[data-is-quick-rating-widget="true"] .w-slide-list');for(var n=t.querySelectorAll(".btn-close-promo-box, button[data-is-close]"),i=0;i<n.length;i++)n[i].addEventListener("click",function(){e.close()});var o=t.querySelector(".w-promotion-offer");o&&(o.addEventListener("click",function(t){t.target===o&&e.close()}),o.classList.remove("is-hidden"));try{window.dispatchEvent(new CustomEvent("postRatingModal:open",{detail:{instance:e,element:t}}))}catch(e){console.error(e)}},closeCallback:function(e){var t=e.getElement();try{window.dispatchEvent(new CustomEvent("postRatingModal:close",{detail:{instance:e,element:t}}))}catch(e){console.error(e)}}});n.open()}}function x(e){var t=e.idTag||null,n=e.rating||null,i=e.idRating||null,o=e.skipPromotion||!1,a=window.articleId,r=window.articleIdEmaki,d=e.listName||null,s={};return s.rating=n,d&&(s.listName=d),a&&(s.idArticle=a),r&&(s.idArticleEmaki=r),t&&(s.idTag=t),i&&(s.idRating=i),idMod&&(s.idMod=idMod),o&&(s.skipPromotion=o),s}function k(e){var t=document.getElementById("user-info-div");if(e){var n=document.getElementById("commentInput");setElementVisibility(n,"hide","blur");var i=document.getElementById("btn-comment-submit");i&&setElementVisibility(i,"show"),t&&(t.style.display="");var o=document.getElementById("comment-submit-rules");o&&(o.style=null);var a=document.getElementById("commentTextEditor");a&&setElementVisibility(a,"show");var r=document.getElementById("commentToolbar");r&&setElementVisibility(r,"show"),setTimeout(function(){var e=a.querySelector("[contenteditable]");e&&e.focus()},0)}}function _(e){return function(e){return fetch("/comment-vote/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(e).toString()})}(e).then(function(t){!function(e){var t=Object.assign({dateCreated:Date.now()},e);localStorage.setItem("votes_".concat(e.idComment),JSON.stringify(t));var n=document.getElementById("user-comment-votes-"+e.idComment);if(n){var i=+n.innerHTML;0==(i+=e.voteDifference)&&(i=" "),n.innerText=i}var o=document.getElementById("user-comment-up-"+e.idComment),a=document.getElementById("user-comment-down-"+e.idComment);e.voteUp?(o.classList.add("voted"),a.classList.remove("voted")):e.voteDown?(o.classList.remove("voted"),a.classList.add("voted")):(o.classList.remove("voted"),a.classList.remove("voted"))}(e)})}function P(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.getText(),o=e.root.innerHTML;n||(n=document.querySelector("#fileInput"));var a=!!n&&n.files.length>0,r=0===i.trim().length&&"<p><br></p>"===o;a||!r?(t.classList.remove("disabled"),t.style.pointerEvents="auto",t.style.opacity="1"):(t.classList.add("disabled"),t.style.pointerEvents="none",t.style.opacity="0.5")}if(window.checkCommentVotes=function(){for(var e in localStorage){if(-1!=e.indexOf("votes_"))JSON.parse(localStorage.getItem(e)).dateCreated<Date.now()-864e5&&localStorage.removeItem(e)}var t=document.querySelectorAll(".user-comment-vote-btn[data-vote-type='up']");t&&t.length>0&&t.forEach(function(e){if(!e.classList.contains("voted")){var t=localStorage.getItem("votes_".concat(e.dataset.idComment));if(t)if("up"==JSON.parse(t).voteType){e.dataset.reset="true",e.classList.add("voted");var n=e.querySelector(".comment-option-text"),i=parseInt(n.innerText);i=null==i||isNaN(i)?1:i+1,n.innerText=i}}});var n=document.querySelectorAll(".user-comment-vote-btn[data-vote-type='down']");n&&n.length>0&&n.forEach(function(e){if(!e.classList.contains("voted")){var t=localStorage.getItem("votes_".concat(e.dataset.idComment));if(t)"down"==JSON.parse(t).voteType&&(e.dataset.reset="true",e.classList.add("voted"))}})},window.onCommentStateUpdated=function(){!function(){for(var e=document.querySelectorAll("button[data-user-id-public]"),t=function(){var t=e[n];if(t.alreadyAttached)return 1;t.addEventListener("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var n=t.getAttribute("data-user-id-public"),i=t.getAttribute("data-user-display-name");try{navigator.clipboard.writeText("|@".concat(i,"#").concat(n,"|")),window.displaySuccessMessage("".concat(i,"#").concat(n," copied to clipboard")),t.classList.add("is-copied"),setTimeout(function(){t.classList.remove("is-copied")},2e3)}catch(e){return t.classList.add("is-error"),void window.displayErrorMessage("Please allow clipboard access.")}}),t.alreadyAttached=!0},n=0;n<e.length;n++)t()}(),window.makeSingleImageClickableOnLazyLoadedList&&window.makeSingleImageClickableOnLazyLoadedList()},window.submitComment=function(e){if(window.allowNewComments&&p(e)){var t=document.getElementById("btn-comment-submit"),n=(document.getElementById("displayNameBox"),document.getElementById("comment-submit-rules"),document.getElementById("is-rating-enabled")?document.getElementById("is-rating-enabled").value:0),i=null,o=document.querySelector('input[name="rate"]:checked');if(o&&(i=o.value),n&&n>0&&(null==o||null==i))window.displayErrorMessage("Please provide a review score.");else{var a=window.articleId,r=window.articleIdEmaki,d=window.quillEditor.commentTextEditor,s=q(d?d.root.innerHTML:""),l=B(s);if(l.length&&(l.length>2e3||s.length>3e3))window.displayErrorMessage("Comment length exceeds the maximum limit.");else if(Y(s)){var c=window.tagId,u=window.idMod;if((l.length&&l.length>0||n&&n>0||window.uploadedImage)&&(a||c||u)&&window.enableCommentSubmit){window.enableCommentSubmit=!1;var m=new XMLHttpRequest;m.open("POST","/comment-submit/",!0);var w=new FormData;window.uploadedImage&&w.append("file",window.uploadedImage),w.append("comment",s),w.append("rating",i),a&&w.append("idArticle",a),r&&w.append("idArticleEmaki",r),c&&w.append("idTag",c),u&&w.append("idMod",u),t&&t.dataset.idRating&&w.append("idRating",t.dataset.idRating);var g=!1;e.hasOwnProperty("newDisplayName")&&(w.append("newDisplayName",e.newDisplayName),g=!0,delete e.newDisplayName),m.onreadystatechange=function(){if(4==m.readyState&&m.response){var e=JSON.parse(m.response);if(e.error)window.displayErrorMessage(e.message,null!=c?c:null);else{if(window.quillEditor.commentTextEditor){window.quillEditor.commentTextEditor.setContents([]);var i=document.getElementById("imageAttached");i&&i.classList.add("is-hidden")}if(e.commentHtml){var o=e.commentHtml,a=document.getElementById("comment-form");if(n){var r=document.getElementById("comment-inplace");r.innerHTML=o,r.classList.remove("is-hidden"),a.classList.add("is-hidden")}else{document.getElementById("comments-feed-list").insertAdjacentHTML("afterbegin",o),a.classList.remove("is-hidden")}var d=document.getElementById("noCommentMessage");d&&(d.innerHTML="",d.style.display="none");var s=document.getElementById("comments-number");if(s){var l=+s.innerHTML;l++,s.innerText=l,s.classList.remove("is-hidden")}window.uploadedImage&&(window.uploadedImage=null),n?window.displaySuccessMessage("Your review has been saved successfully"):window.displaySuccessMessage("Your comment has been saved successfully")}window.addCommentOptionsEventListeners(),window.addUpvoteEventListeners(),window.commentPage=e.commentPage;var u=document.getElementById("nextButton");if(u&&(e.isLastPage?u.style.display="none":u.style.display="flex"),e.rating){e.idRating&&t&&(t.setAttribute("data-id-rating",e.idRating),window.displaySuccessMessage("Your rating has been saved successfully"));var w=null;e.idComment&&(w=e.idComment),window.handleRatingInputAfterSubmit(c,e.rating,w)}g&&window.location.reload()}window.enableCommentSubmit=!0,window.onCommentStateUpdated()}},m.send(w)}}}}},window.handleRatingInputAfterSubmit=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;document.querySelectorAll(".active-rating-".concat(e,".rate-cta.user-rating-input-container")).forEach(function(e){e.classList.add("is-hidden")}),document.querySelectorAll(".active-rating-".concat(e,".rate-cta.user-rating-score")).forEach(function(e){n?e.setAttribute("data-id-comment",n):e.removeAttribute("data-id-comment"),e.classList.remove("is-hidden")});var i=document.getElementById("thread-user-rating-score");i&&i.classList.remove("is-hidden");var o=document.getElementById("ratingInput");if(o&&o.classList.add("is-hidden"),document.querySelectorAll(".active-rating-".concat(e,".rating-text.rate-number")).forEach(function(e){e.innerHTML=t+"<em>/10</em>"}),n){window.enableExistingUserRatingButtons();var a,r=C(document.querySelectorAll(".active-rating-".concat(e,".review-link")));try{for(r.s();!(a=r.n()).done;){a.value.innerText="See Your Review"}}catch(e){r.e(e)}finally{r.f()}}document.querySelectorAll(".active-rating-".concat(e,".user-rating-input")).forEach(function(e){e.parentElement.classList.add("active-rating")}),document.querySelectorAll('[data-rating-group="true"][data-id-tag="'.concat(e,'"] input')).forEach(function(e){e.hasAttribute("data-checked")&&(e.removeAttribute("data-checked"),e.removeAttribute("checked")),e.value==t&&(e.setAttribute("data-checked",""),e.setAttribute("checked",""),console.log("data-checked",e))}),window.updateAllRatingsStatesOnPage()},window.updateAllRatingsStatesOnPage=function(){var e,t=C(document.querySelectorAll(".tag-interaction-rating input"));try{for(t.s();!(e=t.n()).done;){var n=e.value;n.hasAttribute("data-checked")?(console.log("toggledOn",n),n.checked=!0):n.checked=!1}}catch(e){t.e(e)}finally{t.f()}console.log("DONE")},window.submitDisplayCardCommentAction=function(e){return fetch("/comment-submit/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(e).toString()})},window.submitDisplayCardComment=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=e.loggedInUser||null,i=e.idTag||null,o=e.idMod||null,a=e.rating||null,r=e.idRating||null,d=e.skipPromotion||!1,s=e.listName||null;if(p(n,!0,"thread",!a,{mode:"popup",idParent:null,className:"popup",triggeredFrom:"tag_rating",gaEventCategory:"tag_rating",showCloseButton:!0,valnetLoginAction:{apiCallCallback:"window.submitDisplayCardCommentAction",apiCallCallbackOptions:e}}))if(null!=i&&null!=a){var l=document.querySelector(".active-rating-"+i+".review-link.is-hidden"),c=window.articleId,u=window.articleIdEmaki;if(i&&window.enableCommentSubmit){window.enableCommentSubmit=!1;var m=new XMLHttpRequest;m.open("POST","/comment-submit/",!0),m.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var w=new URLSearchParams;w.append("rating",a),c&&w.append("idArticle",c),u&&w.append("idArticleEmaki",u),i&&w.append("idTag",i),r&&w.append("idRating",r),o&&w.append("idMod",o),d&&w.append("skipPromotion",d),m.onreadystatechange=function(){if(4==m.readyState&&m.response){var e=JSON.parse(m.response);if(e.error)window.displayErrorMessage(e.message);else{if(l&&l.classList.remove("is-hidden"),e.rating&&e.idRating){var n=document.querySelector('[data-id="dc-'.concat(i,'-ratingInputUser"]'));n&&n.setAttribute("data-id-rating",e.idRating);var o=document.getElementById("btn-comment-submit");o&&o.setAttribute("data-id-rating",e.idRating)}window.handleRatingInputAfterSubmit(i,e.rating)}window.enableCommentSubmit=!0,t&&t(e)}},m.send(w.toString())}}else window.displayErrorMessage("Please provide a review score.");else s&&i&&(document.cookie="".concat(s,"=").concat(i))},window.setElementVisibility=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"show",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"blur",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;t=!0===t||"show"===t,n=!0===n||"focus"===n,e&&(t?(e.style.display="block",n&&e.focus()):(e.style.display="none",i&&(e.innerHTML=i),e.blur()))},window.expandComments=function(){document.getElementById("w-comment-feed").classList.add("is-expand");var e=document.getElementById("expand-comments-button");setElementVisibility(e,"hide","blur")},window.changeInputToTextarea=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(window.location.pathname,document.getElementById("user-info-div")),i=L({},i);i.valnetLoginAction={afterLogin:{action:"quill"}};var o=p(e,t,"thread",!0,i);if(o){var a=document.getElementById("commentInput");if(a)if("true"==a.getAttribute("data-has-ratings"))k(o);else n.style.display="none",a.addEventListener("click",function(e){return e.stopPropagation(),k(o),!1}),document.getElementById("commentTextEditor").style.display="none",document.getElementById("commentToolbar").style.display="none"}},window.fetchArticleComments=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.getElementById("commentInput"),i=document.getElementById("userRatingCommentId"),o=document.getElementById("is-rating-enabled"),a=new XMLHttpRequest;a.open("POST","/comment-fetch/",!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var r=new URLSearchParams,d=window.articleIdEmaki,s=window.batchSize?window.batchSize:10,l=window.childBatchSize?window.childBatchSize:10,c=window.commentPage?window.commentPage:1,u=window.sortOrder?window.sortOrder:"RECOMMENDED",m=window.tagId,w=window.idMod;d&&r.append("idArticle",d),m&&r.append("idTag",m),w&&r.append("idMod",w),r.append("commentPage",c),r.append("direction",e),r.append("batchSize",s),r.append("childBatchSize",l),r.append("sortOrder",u),r.append("isSorted",t),r.append("permalink",window.location.pathname),i&&i.value&&r.append("userCommentId",i.value),o&&o.value&&r.append("isRatingEnabled",o.value),a.onreadystatechange=function(){if(4==a.readyState&&a.response){var e=JSON.parse(a.response);if(e.error)window.displayErrorMessage(e.message);else{n&&(n.value="");var i=document.getElementById("comments-feed-list"),o=e.commentsListHtml,r=document.querySelectorAll(".comments-feed-item");r&&r.length>0&&r.forEach(function(e){e.classList.remove("is-last")}),t?window.adsNinja&&window.adsNinja.initialized?(window.adsNinja=window.adsNinja||{},window.adsNinja.queue=window.adsNinja.queue||[],window.adsNinja.queue.push(function(){try{window.adsNinja.monetizeDynamicContent("comments-feed-list",{name:"comments",groupName:"footer"},"replace",{countAndIgnore:["first"],ignore:["comments-feed-pagination"]},o)}catch(e){console.warn(e),i.innerHTML=o}})):i.innerHTML=o:i.insertAdjacentHTML("beforeend",o),window.addCommentOptionsEventListeners(),window.addUpvoteEventListeners(),window.addSeeMoreButtonEventListeners(),window.commentPage=e.commentPage;var d=document.getElementById("nextButton");if(d){var s=d.parentElement,l="flex";e.isLastPage&&(l="none"),s&&(s.style.display=l)}window.createUserCards(),window.checkCommentVotes(),console.log("%cEvent dispatched : valnet_ui_event:post_load_init","color: green; font-weight: bold;"),window.dispatchEvent(new Event("valnet_ui_event:post_load_init")),"function"==typeof window.handleFollow&&window.handleFollow()}window.onCommentStateUpdated()}},a.send(r.toString())},window.fetchCommentReplies=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=document.getElementById("commentInput"),o=new XMLHttpRequest;o.open("POST","/comment-reply-fetch/",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var a=new URLSearchParams,r=e.dataset.idComment,d=e.dataset.commentPage,s=window.childBatchSize?window.childBatchSize:10,l=window.sortOrder?window.sortOrder:"RECOMMENDED";a.append("idComment",r),a.append("commentPage",d),a.append("direction",t),a.append("batchSize",s),a.append("sortOrder",l),a.append("isSorted",n),a.append("permalink",window.location.pathname),o.onreadystatechange=function(){if(4==o.readyState&&o.response){var t=JSON.parse(o.response);if(t.error)window.displayErrorMessage(t.message);else{i&&(i.value="");var n=t.repliesListHtml;if(e.parentNode.insertAdjacentHTML("beforebegin",n),window.addCommentOptionsEventListeners(),window.addUpvoteEventListeners(),e.dataset.commentPage=t.commentPage,t.isLastPage){var a=e.parentElement;a&&a.remove(),e.style.display="none"}else e.style.display="flex";console.log("%cEvent dispatched : valnet_ui_event:post_load_init","color: green; font-weight: bold;"),window.dispatchEvent(new Event("valnet_ui_event:post_load_init"))}window.onCommentStateUpdated()}},o.send(a.toString())},window.displayErrorMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=document.getElementById("comment-error"),o=document.getElementById("comment-error-text");t&&document.getElementById("comment-error-".concat(t))&&(i=document.getElementById("comment-error-".concat(t)),o=document.getElementById("comment-error-text-".concat(t))),i&&(i.classList.remove("is-hidden"),i.classList.remove("fade-out"),i.classList.add("fade-in"),o.innerText=e,n&&i.scrollIntoView({behavior:"auto",block:"center",inline:"nearest"})),setTimeout(function(){i&&(i.classList.remove("fade-in"),i.classList.add("fade-out"),i.classList.remove("is-hidden"))},2e3)},window.hideErrorMessage=function(){var e=document.getElementById("comment-error");e&&e.classList.add("is-hidden")},window.displaySuccessMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=document.getElementById("comment-success"),i=document.getElementById("comment-success-text");t&&document.getElementById("comment-success-".concat(t))&&(n=document.getElementById("comment-success-".concat(t)),i=document.getElementById("comment-success-text-".concat(t))),n&&(n.classList.remove("is-hidden"),n.classList.remove("fade-out"),n.classList.add("fade-in"),i.innerText=e),setTimeout(function(){n&&(n.classList.remove("fade-in"),n.classList.add("fade-out"),n.classList.remove("is-hidden"))},2e3)},window.displayRatingSuccessMessage=function(){var e=document.createElement("div");e.innerHTML='\n        <div class="icon"></div>\n        <p id="rating-success-text" class="user-msg">Your rating has been saved successfully.</p>',e.id="rating-success",e.className="w-user-msg user-alert overlay center alert-success",document.body.appendChild(e),setTimeout(function(){e&&e.remove()},2e3)},window.hideSuccessMessage=function(){var e=document.getElementById("comment-success");e&&e.classList.add("is-hidden")},window.hideAllMessages=function(){window.hideErrorMessage(),window.hideSuccessMessage()},window.deleteComment=function(e){if(e&&null!=e&&null!=e){T&&T.abort();var t=e.dataset.idTag,n={idComment:e.dataset.idComment,idArticle:e.dataset.idArticle,idTag:t,idMod:e.dataset.idMod,userEmail:e.dataset.userEmail,idParent:e.dataset.idParent,idArticleEmaki:window.articleIdEmaki};if(n){window.hideAllMessages();var i=document.getElementById("is-rating-enabled").value;(T=new XMLHttpRequest).open("POST","/comment-delete/",!0),T.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var o=new URLSearchParams,a=0,r=Object.entries(n);a<r.length;a++){var d=b(r[a],2),s=d[0],l=d[1];o.append(s,l)}T.onreadystatechange=function(){if(4==T.readyState){if(T.response){var e=JSON.parse(T.response);if("success"==e.status){var o=document.getElementById("comment-"+n.idComment);o&&o.remove();var a=document.querySelectorAll("li[data-id-parent='".concat(n.idComment,"']"));if(a&&a.forEach(function(e){e.remove()}),n.idParent){var r=document.getElementById("replyCount-"+n.idParent);if(r){var d=0;r.innerText&&""!=r.innerText.trim()&&(d=parseInt(r.innerText)-1),0==d?(r.innerText="",r.classList.add("is-hidden")):r.innerText=d}}if(i){var s=document.getElementById("comment-form"),l=document.getElementById("comment-inplace");l.classList.contains("is-hidden")||l.classList.add("is-hidden"),s.classList.contains("is-hidden")&&s.classList.remove("is-hidden");var c=document.querySelector('input[name="rate"]:checked');c&&(c.checked=!1),(c=document.querySelector('input[name="rate-'+n.idComment+' "]:checked'))&&(c.checked=!1),window.resetRatingForSubmission(t),window.queueThreadRatingForSubmission(),createCommentEventListeners()}window.displaySuccessMessage(e.message);var u=document.getElementById("comment-success");setTimeout(function(){u.classList.add("is-hidden")},2e3);var m=window.websiteUser||null;window.changeInputToTextarea(m)}else window.displayErrorMessage(e.message)}T=!1,window.onCommentStateUpdated()}},T.send(o.toString())}}},window.toggleDeletePopup=function(e){var t=e.dataset.idComment,n=document.getElementById("deletePopupContainer-"+t);n&&n.classList.toggle("is-hidden")},window.deleteImage=function(e){var t=e.dataset.idComment;if(t){window.uploadedImages&&window.uploadedImages[t]&&(window.uploadedImages[t]=null);var n=document.querySelector('div[data-comment-image-id="'.concat(t,'"]'));n&&n.classList.add("is-hidden");var i=document.getElementById("imageAttached-"+t);i&&i.classList.add("is-hidden");var o=document.getElementById("submitEditedCommentBtn-"+t);o&&o.removeAttribute("data-img-url")}var a=e.dataset.idParentComment;if(a){window.uploadedReplyImages&&window.uploadedReplyImages[a]&&(window.uploadedReplyImages[a]=null);var r=document.getElementById("replyImageAttached-"+a);r&&r.classList.add("is-hidden")}if(!t&&!a&&window.uploadedImage){var d=window.quillEditor.commentTextEditor,s=document.getElementById("btn-comment-submit");d&&s&&P(d,s),window.uploadedImage=null;var l=document.getElementById("imageAttached");l&&l.classList.add("is-hidden")}},window.changeEditMode=function(e,t){var n=e.dataset.idComment;if(n){var i=document.getElementById("existingCommentDiv-"+n),o=document.getElementById("editCommentContainer-"+n),a=document.getElementById("commentOptions-"+n),r=document.getElementById("userRatingDisplay-"+n),d=document.getElementById("userRatingValue-"+n);d&&d.value>0&&(document.getElementById("star"+d.value/2+"-"+n).checked=!0);var s=window.quillEditor["editTextEditor-"+n];if(i&&o&&a)if("edit"==t){s?s.root.innerHTML=X(i.innerHTML):window.initQuill("editTextEditor-"+n,"editToolbar-"+n,i.innerHTML),o.classList.remove("is-hidden"),i.classList.add("is-hidden"),a.classList.add("is-hidden"),r&&!r.classList.contains("is-hidden")&&r.classList.add("is-hidden");var l=document.querySelector('div[data-comment-image-id="'.concat(n,'"]'));if(l){l.classList.add("is-hidden");var c=document.getElementById("imageAttached-"+n);c&&c.classList.remove("is-hidden")}var u=document.getElementById("commentFooter-"+n);u&&u.classList.add("is-hidden"),window.removeThreadRatingEventListeners(e)}else{s?s.setContents([]):window.initQuill("editTextEditor-"+n,"editToolbar-"+n,""),i.classList.remove("is-hidden"),o.classList.add("is-hidden"),a.classList.remove("is-hidden"),r&&r.classList.contains("is-hidden")&&r.classList.remove("is-hidden");var m=document.querySelector('div[data-comment-image-id="'.concat(n,'"]'));if(m){m.classList.remove("is-hidden");var w=document.getElementById("imageAttached-"+n);w&&w.classList.add("is-hidden");var p=document.getElementById("submitEditedCommentBtn-"+n);p&&p.setAttribute("data-img-url",m.getAttribute("data-img-url"))}var g=document.getElementById("commentFooter-"+n);g&&g.classList.remove("is-hidden")}}},window.submitEditedComment=function(e){if(e&&null!=e&&null!=e){p(window.websiteUser||null),T&&T.abort();var t=e.dataset.idComment,n=e.dataset.imgUrl,i=e.dataset.idTag,o=e.dataset.idMod,a=null,r=document.querySelector('input[name="rate-'+t+'"]:checked'),d=document.getElementById("is-rating-enabled")?document.getElementById("is-rating-enabled").value:0;if(r&&(a=r.value),d&&d>0&&(null==r||null==a))window.displayErrorMessage("Please provide a review score.");else{var s=window.quillEditor["editTextEditor-"+t],l=q(s?s.root.innerHTML:""),c=B(l),u=!1;if((n||window.uploadedImages&&window.uploadedImages[t])&&(u=!0),c.length&&0!=c.length||u){if(c.length>2e3||l.length>3e3)window.displayErrorMessage("Comment exceeds maximum length.");else if(Y(l)&&t&&(c.length&&c.length>0||u)&&c.length<=2e3&&l.length<=3e3){window.hideAllMessages(),(T=new XMLHttpRequest).open("POST","/comment-edit/",!0);var m=new FormData;window.uploadedImages&&window.uploadedImages[t]&&m.append("file",window.uploadedImages[t]),n&&m.append("imageUrl",n),m.append("idComment",t),m.append("comment",l),m.append("rating",a),T.onreadystatechange=function(){if(4==T.readyState){if(T.response){var e=JSON.parse(T.response);if("success"==e.status){var n=document.getElementById("existingCommentDiv-"+t),r=document.getElementById("editCommentContainer-"+t),d=document.getElementById("commentOptions-"+t),s=document.getElementById("userRatingDisplay-"+t);if(n&&r){var u,m,w=null!==(u=e.ratingValue)&&void 0!==u?u:a;if(s&&(s.innerHTML='<input type="hidden" id="userRatingValue-'+t+'" value="'+w+'"/><span class="user-rating-text"><i class="icon i-star"></i>'+w+'<em class="rate-denominator">/10</em></span>'),0!=c.length)n.innerHTML=null!==(m=e.commentText)&&void 0!==m?m:l,n.classList.remove("is-hidden");else n.innerHTML="";r.classList.add("is-hidden"),d.classList.remove("is-hidden"),s&&s.classList.contains("is-hidden")&&s.classList.remove("is-hidden"),w&&i&&window.handleRatingInputAfterSubmit(i,w,t),w&&o&&window.handleRatingInputAfterSubmit(o,w,t)}var p=document.getElementById("commentFooter-"+t);if(p&&p.classList.remove("is-hidden"),window.uploadedImages&&window.uploadedImages[t]&&(window.uploadedImages[t]=null),e.imageUrl){var g=document.getElementById("imageAttached-"+t);g&&g.classList.add("is-hidden");var v=document.querySelector('div[data-comment-image-id="'.concat(t,'"]'));v?(v.innerHTML='<img src="'+e.imageUrl+'"/>',v.classList.remove("is-hidden")):(v=n.querySelector("image-expandable"))&&(v.innerHTML='<img src="'+e.imageUrl+'"/>');var f=document.getElementById("submitEditedCommentBtn-"+t);f&&f.setAttribute("data-img-url",e.imageUrl)}if(e.message){var h=document.getElementById("commenEditSuccess-"+t);h.classList.remove("is-hidden"),setTimeout(function(){h.classList.add("is-hidden")},2e3),n.classList.add("is-edited")}}else window.displayErrorMessage(e.message)}T=!1,window.onCommentStateUpdated()}},T.send(m)}}else window.displayErrorMessage("Comment is empty.")}}},window.replyToComment=function(e){if(!(!e||null==e||null==e)&&window.allowNewComments){var t=window.websiteUser||null,n=L({},n);if(e.dataset&&e.dataset.idComment){var i={action:"reply",data:e.dataset};e.dataset.withMentionId&&(i.action="redirectThenReply"),n.valnetLoginAction={afterLogin:i}}if(p(t,!0,"thread",!0,n)){window.toggleCorrespondingDisplayNameBoxIfAny(e);var o=e.dataset.idComment,a=document.getElementById("replyCommentContainer-"+o),r=document.querySelectorAll(".w-user-comment-text.reply"),d=e.dataset.editorContainer,s=null;if(d&&(s=document.querySelector('[data-comment-editor-container="'.concat(d,'"]'))),r.forEach(function(e){a!=e&&e.classList.add("is-hidden")}),a)a.removeAttribute("data-ref-reply-id-comment"),s&&(s.appendChild(a),a.setAttribute("data-ref-reply-id-comment",d)),a.classList.remove("is-hidden"),window.quillEditor["replyTextEditor-"+o]||window.initQuill("replyTextEditor-"+o,"replyToolbar-"+o),setTimeout(function(){var t=document.getElementById("replyTextEditor-".concat(o));t&&t.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"});var n=window.quillEditor["replyTextEditor-".concat(o)];n&&e.dataset.withMentionId&&e.dataset.withMentionName&&(n.focus(),n.pasteHTML("|@".concat(e.dataset.withMentionName,"#").concat(e.dataset.withMentionId,"|&nbsp;")),n.setSelection(n.container.innerHTML.length))},100);window.unhideAllCommentFooters();var l=document.getElementById("commentFooter-"+(d||o));l&&l.classList.add("is-hidden"),window.onCommentStateUpdated()}}},window.cancelReplyComment=function(e){if(e&&null!=e&&null!=e&&p(window.websiteUser||null)){window.toggleCorrespondingDisplayNameBoxIfAny(e);var t=e.dataset.idComment,n=(e.dataset.editorContainer,document.getElementById("replyCommentContainer-"+t));if(n){n.removeAttribute("data-ref-reply-id-comment"),n.classList.add("is-hidden");var i=window.quillEditor["replyTextEditor-"+t];i&&i.setContents([])}window.unhideAllCommentFooters(),window.onCommentStateUpdated()}},window.unhideAllCommentFooters=function(){var e,t=C(document.querySelectorAll("[data-comment-footer-id]"));try{for(t.s();!(e=t.n()).done;){e.value.classList.remove("is-hidden")}}catch(e){t.e(e)}finally{t.f()}},window.submitReplyComment=function(e){if(console.log("REPLY COMMENT"),e&&null!=e&&null!=e){var t=p(window.websiteUser||null,!0);if(t){var n;console.log("REPLY COMMENT 2 -",t),e.dataset&&e.dataset.idComment?n=e.dataset.idComment:console.log("The 'idComment' dataset attribute does not exist.");var i=document.getElementById("replyCommentContainer-"+n),o=window.articleId,a=window.articleIdEmaki,r=window.tagId,d=i.getAttribute("data-ref-reply-id-comment"),l=window.idMod;console.log("REPLY COMMENT 3 -",n);var c=window.quillEditor["replyTextEditor-"+n],u=q(c?c.root.innerHTML:""),m=B(u);if(m.length&&(m.length>2e3||u.length>3e3))window.displayErrorMessage("Comment length exceeds the maximum limit.");else if(Y(u)&&(m.length&&m.length>0||window.uploadedReplyImages&&window.uploadedReplyImages[n])&&m.length<=2e3&&u.length<=3e3&&(o||l)&&window.enableCommentSubmit){window.enableCommentSubmit=!1;var w=new XMLHttpRequest;w.open("POST","/comment-submit/",!0);var g=new FormData;window.uploadedReplyImages&&window.uploadedReplyImages[n]&&g.append("file",window.uploadedReplyImages[n]),g.append("comment",u),o&&g.append("idArticle",o),a&&g.append("idArticleEmaki",a),r&&g.append("idTag",r),l&&g.append("idMod",l),g.append("idParentComment",n);var v=window.getCorrespondingDisplayNameBoxIfAny(e);v&&g.append("newDisplayName",v.querySelector("input").value.trim()),w.onreadystatechange=function(){if(4==w.readyState&&w.response){var e=JSON.parse(w.response);if(e.error)window.displayErrorMessage(e.message);else{c&&c.setContents([]),i.classList.add("is-hidden"),window.uploadedReplyImages&&window.uploadedReplyImages[n]&&(window.uploadedReplyImages[n]=null);var t=document.getElementById("replyImageAttached-"+n);t&&t.classList.add("is-hidden");document.getElementById("comments-feed-list");var o=e.commentHtml,a=document.getElementById("comment-"+n);if(a)if(d!=n){var r=document.getElementById("comment-"+d);if(r){var l=(0,s.CC)("".concat(o)),u=l.querySelector(".first");u&&u.classList.remove("first"),l.classList.remove("first"),r.after(l)}}else{var m=a.nextElementSibling;m&&m.classList.remove("first"),a.insertAdjacentHTML("afterend",o)}var p=document.getElementById("replyCount-"+n);if(p){var g=1;p.innerText&&""!=p.innerText.trim()&&(g=parseInt(p.innerText)+1),p.classList.remove("is-hidden"),p.innerText=g}window.addCommentOptionsEventListeners();var f=document.getElementById("nextReplyButton-"+n);f&&(e.isLastPage?f.style.display="none":f.style.display="block");var h=document.getElementById("comments-number");if(h){var y=+h.innerHTML;y++,h.innerText=y,h.classList.remove("is-hidden")}window.uploadedImage&&(window.uploadedImage=null),window.unhideAllCommentFooters(),window.displaySuccessMessage("Your comment has been saved successfully");var b=document.getElementById("comment-success");setTimeout(function(){b.classList.add("is-hidden")},2e3),v&&window.location.reload()}window.enableCommentSubmit=!0,window.onCommentStateUpdated()}},w.send(g)}}}},window.addCommentOptionsEventListeners=function(){var e=document.querySelectorAll(".comment-options-btn");e.length>0&&e.forEach(function(e){var t=e.firstElementChild;t&&(e.isAlreadyAttached||(e.removeEventListener("mouseenter",function(){}),e.removeEventListener("mouseleave",function(){}),e.addEventListener("mouseenter",function(){t.classList.add("active")}),e.addEventListener("mouseleave",function(){t.classList.remove("active")}),e.isAlreadyAttached=!0))})},window.addUpvoteEventListeners=function(){var e=document.querySelectorAll(".user-comment-vote-btn");e.length>0&&e.forEach(function(e){e.isAlreadyAttached||(e.closest("div").classList.contains("is-own")||(e.isAlreadAttached=!0,e.addEventListener("click",function(t){t.stopPropagation();var n=window.websiteUser||null;return window.voteComment(t,n,e),window.dispatchEvent(new CustomEvent("sentinel:relay:tracker",{detail:{event:t}})),!1})),e.isAlreadyAttached=!0)})},window.addSeeMoreButtonEventListeners=function(){var e=document.querySelectorAll(".comment-prev-next.reply-next");e.length>0&&e.forEach(function(e){e.isAlreadyAttached||(e.addEventListener("click",function(){window.hideAllMessages(),window.fetchCommentReplies(this,"next")}),e.isAlreadyAttached=!0)})},window.voteComment=function(e,t,n){if(void 0!==n&&n){var i=n.dataset.reset,o={idParent:n.dataset.idParent,idComment:n.dataset.idComment,idArticle:n.dataset.idArticle,idTag:n.dataset.idTag,idMod:n.dataset.idMod,voteType:n.dataset.voteType},a=document.getElementById("user-comment-up-"+o.idComment),r=document.getElementById("user-comment-down-"+o.idComment),d=0;"up"==n.dataset.voteType&&"false"==i?(d=1,o.voteUp=!0,a.dataset.reset="true",o.voteDown=!1,r.dataset.reset="false"):"up"==n.dataset.voteType&&"true"==i?(d=-1,o.voteUp=!1,a.dataset.reset="false",o.voteDown=!1,r.dataset.reset="false",o.voteType=null):"down"==n.dataset.voteType&&"false"==i?("true"==a.dataset.reset&&(d=-1),o.voteDown=!0,r.dataset.reset="true",o.voteUp=!1,a.dataset.reset="false"):"down"==n.dataset.voteType&&"true"==i&&(d=0,o.voteDown=!1,r.dataset.reset="false",o.voteUp=!1,a.dataset.reset="false",o.voteType=null),o.voteDifference=d;var s=L({},s);s.valnetLoginAction={apiCallCallback:"window.globalcommentVoteAction",apiCallCallbackOptions:o},p(t,!0,"thread",!0,s)&&o&&_(o).catch(function(e){window.displayErrorMessage(e.message)})}},window.globalcommentVoteAction=function(e){_(e).catch(function(e){window.displayErrorMessage(e.message)})},window.createCommentEventListeners=function(){window.addEventListener("valnet_ui_event:user_not_logged_in",function(){J()}),window.addEventListener("valnet_ui_event:user_not_verified",function(){J()});var e=window.websiteUser||null,t=document.getElementById("btn-comment-submit");t&&t.addEventListener("click",function(t){var n=window.getCorrespondingDisplayNameBoxIfAny(t.currentTarget);n&&(e.newDisplayName=n.querySelector("input").value.trim()),window.hideAllMessages(),window.submitComment(e)});var n=document.getElementById("prevButton");n&&n.addEventListener("click",function(){window.hideAllMessages(),window.fetchArticleComments("previous")});var i=document.getElementById("nextButton");i&&i.addEventListener("click",function(){window.hideAllMessages(),window.fetchArticleComments("next")});var o=document.getElementById("expand-comments-button");o&&o.addEventListener("click",function(){window.hideAllMessages(),window.expandComments()});var a=document.getElementById("commentInput");a&&a.addEventListener("click",function(t){return t.preventDefault(),t.stopPropagation(),location.hash="threads",window.hideAllMessages(),window.changeInputToTextarea(e,!0,t.target),!1});var r=document.getElementById("ratingInput");r&&r.addEventListener("click",function(t){t.stopPropagation(),window.hideAllMessages();var n={mode:"popup",idParent:null,className:"popup",triggeredFrom:"tag_rating",gaEventCategory:"tag_rating",showCloseButton:!0,valnetLoginAction:{apiCall:submitDisplayCardCommentAction.bind(this,x()),apiCallCallback:"window.submitDisplayCardComment",apiCallCallbackOptions:x()}};p(e,!0,"thread",!1,n),location.hash="threads"});var d=document.getElementById("thread-sort");d&&d.addEventListener("change",function(){"newest"==d.value?window.sortOrder="DESC":"oldest"==d.value?window.sortOrder="ASC":window.sortOrder="RECOMMENDED",window.hideAllMessages(),window.fetchArticleComments("next",!0)}),console.log("%cEvent dispatched : valnet_ui_event:post_load_init","color: green; font-weight: bold;"),window.dispatchEvent(new Event("valnet_ui_event:post_load_init")),document.querySelectorAll(".user-card").forEach(function(e){e.addEventListener("click",function(t){t.target.closest(".w-social-follow-button")||e.getAttribute("data-user-id-public")&&(window.location.href="/profile/"+e.getAttribute("data-user-id-public")+"/")})}),e&&window.checkCommentVotes(),window.addUpvoteEventListeners(),window.addSeeMoreButtonEventListeners(),window.addCommentOptionsEventListeners(),window.changeInputToTextarea(e),window.onCommentStateUpdated(),window.enableRateNowStarButtons(),window.enableExistingUserRatingButtons(),window.enableRatingCardRatingLinks(),window.enableRatingCardPagination&&window.enableRatingCardPagination(),window.enableQuickRatingCardJumpTo(),window.initializeInteractives&&window.initializeInteractives()},window.enableQuickRatingCardJumpTo=function(){var e,t=C(document.querySelectorAll(".display-card.dc-quick-rating"));try{var n=function(){var t=e.value;if(t.isJumpToAttached)return 1;t.addEventListener("click",function(e){if(!e.currentTarget.classList.contains("in-focus")){var n=new CustomEvent("vn_ui:jump_to",{bubbles:!0,cancelable:!0,detail:{target:e.target}});t.dispatchEvent(n)}}),t.isJumpToAttached=!0};for(t.s();!(e=t.n()).done;)n()}catch(e){t.e(e)}finally{t.f()}},window.queueRatingForSubmission=function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=C(document.querySelectorAll(".w-user-rating"));try{for(o.s();!(n=o.n()).done;){var a=n.value,r=a.querySelector(".user-rating-input.user-header-rating");if(r&&!r.classList.contains("is-hidden")){var d=a.querySelector(".rate-cta.user-rating-input-container"),s=a.querySelector(".no-rating.user-rating"),l=a.querySelector(".rate-cta.user-rating-score"),c=a.querySelector(".rating-text.rate-number");if(!(d&&s&&l&&c))continue;"0/10"==c.textContent?(d.classList.remove("is-hidden"),s.classList.remove("is-hidden"),l.classList.add("is-hidden")):(l.classList.remove("is-hidden"),d.classList.add("is-hidden")),r.classList.add("is-hidden")}a.classList.remove("active-rating")}}catch(e){o.e(e)}finally{o.f()}if(t){var u=t.closest(".w-user-rating");u.children[0].classList.remove("is-hidden"),u.classList.add("active-rating"),u.querySelectorAll(".active-rating-".concat(e,".no-rating.user-rating")).forEach(function(e){i?e.classList.remove("is-hidden"):e.classList.add("is-hidden")}),u.querySelectorAll(".active-rating-".concat(e,".user-rating-input.user-header-rating")).forEach(function(e){i?e.classList.add("is-hidden"):e.classList.remove("is-hidden")}),u.querySelectorAll(".active-rating-".concat(e,".rate-cta.user-rating-score")).forEach(function(e){e.classList.add("is-hidden")}),u.querySelectorAll(".active-rating-".concat(e,".user-rating-close-btn")).forEach(function(t){t.addEventListener("click",function(){var t=document.querySelector('[data-id="dc-'.concat(e,'-ratingInputUser"]'));t&&(t.getAttribute("data-id-rating")?(document.querySelectorAll(".active-rating-".concat(e,".rate-cta.user-rating-score")).forEach(function(e){e.classList.remove("is-hidden")}),document.querySelectorAll(".active-rating-".concat(e,".rate-cta.user-rating-input-container")).forEach(function(e){e.classList.add("is-hidden")})):window.resetRatingForSubmission(e))})})}},window.queueThreadRatingForSubmission=function(){var e=document.getElementById("thread-user-rating-score");e&&e.classList.add("is-hidden");var t=document.getElementById("ratingInput");t&&t.classList.remove("is-hidden")},window.toggleMainThreadPostSubmitButton=function(){var e=window.quillEditor.commentTextEditor,t=document.getElementById("btn-comment-submit");document.getElementById("commentTextEditor");e&&t&&(P(e,t),e.on("text-change",function(n,i,o){"user"===o&&P(e,t)}))},document.getElementById("commentInput")){var R=!1;new Waypoint({element:document.getElementById("commentInput"),handler:function(e){document.getElementById("commentInput")&&(window.addEventListener("valnet_ui_event:quill_injected",function(){console.log("vn_comments quill injected"),R||(R=!0,console.log("attaching comments"),window.initQuill("commentTextEditor","commentToolbar"),"function"==typeof window.toggleMainThreadPostSubmitButton&&window.toggleMainThreadPostSubmitButton())}),function(){var e=!1;console.log("--- triggered injectQuill ---");try{window.Quill&&(e=!0)}catch(e){console.log("quill not found, loading...")}if(e)return console.log("%cEvent dispatched : valnet_ui_event:quill_injected","color: white; background-color: green; padding: 4px;"),void window.dispatchEvent(new Event("valnet_ui_event:quill_injected"));if(!window.valnet_is_quill_injection_started){window.valnet_is_quill_injection_started=!0;var t=null,n=null,o=null,a=function(){this.isLoaded=!0,t&&t.isLoaded&&n&&n.isLoaded&&o&&o.isLoaded&&setTimeout(function(){console.log("%cEvent dispatched : valnet_ui_event:quill_injected","color: white; background-color: green; padding: 4px;"),window.dispatchEvent(new Event("valnet_ui_event:quill_injected"))})};window.quillScriptLocation&&(t=i(window.quillScriptLocation,function(){this.isLoaded=!0;var e=setInterval(function(){var t=!1;try{window.Quill&&(t=!0)}catch(e){console.log("quill not found, loading...")}t&&(clearInterval(e),window.quillEmojiScriptLocation&&(n=i(window.quillEmojiScriptLocation,a,{defer:!0})),window.quillMentionScriptLocation&&(o=i(window.quillMentionScriptLocation,a,{defer:!0})),window.quillMagicUrlScriptLocation&&(o=i(window.quillMagicUrlScriptLocation,a,{defer:!0})))},1)},{defer:!0}))}}()),this.destroy()},offset:function(){return Waypoint.viewportHeight()+300}})}window.initQuill=function(e,t,n){window.quillEditor||(window.quillEditor={}),window.quillEditor[e]=new Quill("#"+e,{modules:{magicUrl:!0,mention:{allowedChars:/^[A-Za-z0-9\s]*$/,mentionDenotationChars:["@"],isolateCharacter:!0,spaceAfterInsert:!0,allowInlineMentionChar:!0,positioningStrategy:"fixed",mentionOptions:z(!0),source:function(e,t,n){var i;if(i="@"==n?z(!0):[],0===e.length)t(i,e);else{for(var o=[],a=0;a<i.length;a++)console.log(i[a]),~i[a].displayName.toLowerCase().indexOf(e.toLowerCase())&&o.push(i[a]);t(o,e)}}},toolbar:{container:"#"+t,handlers:{emoji:function(){},mention:function(){var t=window.quillEditor[e].getSelection();if(t){window.quillEditor[e].insertText(t.index," @"),window.quillEditor[e].setSelection(t.index+2,0),window.quillEditor[e].blur(),window.quillEditor[e].focus();try{var n=window.quillEditor[e].getModule("mention");if(n&&n.mentionContainer){var i=window.quillEditor[e].root.getBoundingClientRect(),o=window.quillEditor[e].getBounds(t.index+1);n.mentionContainer.style.top=i.top+o.top+o.height+"px"}}catch(e){console.log("this shouldn't have happened: ".concat(e))}}},image:function(){window.imageHandler(e)}}},"emoji-toolbar":!0,"emoji-textarea":!1,"emoji-shortname":!0},placeholder:"Share your thoughts",theme:"snow"});window.quillEditor[e].on("text-change",function(t,n,i){var o=window.quillEditor[e].getSelection();try{for(var a=!1,r=0;r<t.ops.length;r++)if(t.ops[r].delete){a=!0;break}if(a&&o){var d=window.quillEditor[e].getLeaf(Math.max(0,o.index))[0],s=!1;d&&d.domNode&&d.domNode.classList&&d.domNode.classList.contains("mention")&&(s=!0),s&&queueMicrotask(function(){d.domNode.remove()})}}catch(e){console.error(e)}if(window.quillEditor[e].getText().length>2e3&&window.quillEditor[e].deleteText(2e3,window.quillEditor[e].getLength()),window.quillEditor[e].getText().match(O)){var l=window.quillEditor[e].root.innerHTML;window.quillEditor[e].root.innerHTML=X(l),setTimeout(function(){window.quillEditor[e].root.focus(),window.quillEditor[e].setSelection(window.quillEditor[e].getLength(),0)},0)}}),document.getElementById(e).addEventListener("click",window.handleCloseEmojiPopupOnEditorClick),n&&(window.quillEditor[e].root.innerHTML=X(n))},window.imageHandler=function(e){var t;(t=document.getElementById("fileInput"))||((t=document.createElement("input")).setAttribute("type","file"),t.setAttribute("accept",".jpg,.jpeg,.png,.x-png,.gif,.webp"),t.setAttribute("id","fileInput"),t.classList.add("is-hidden"),document.body.appendChild(t));t.value="",t.click(),t.addEventListener("change",function(n){var i=window.quillEditor.commentTextEditor,o=document.getElementById("btn-comment-submit");i&&o&&P(i,o,this);var a=t.files[0];if(a){if(a.size/1048576>25)return void window.displayErrorMessage("File size exceeds the limit of 25MB.");var r=document.getElementById("imageAttached");if("commentTextEditor"==e)window.uploadedImage=a;else{var d=e.substring(e.indexOf("-")+1);e.includes("replyTextEditor")?(window.uploadedReplyImages||(window.uploadedReplyImages=[]),window.uploadedReplyImages[d]=a,r=document.getElementById("replyImageAttached-"+d)):(window.uploadedImages||(window.uploadedImages=[]),window.uploadedImages[d]=a,r=document.getElementById("imageAttached-"+d))}if(r){var s=new FileReader;s.onload=function(e){var t=e.target.result,n=document.createElement("img");n.src=t,n.width=860,n.height=715,n.alt="User Uploaded Image",n.loading="lazy",n.decoding="async",n.style.display="block",n.style.height="auto",n.style.maxWidth="100%";var i=r.querySelector(".threads-attachment-img");i&&(i.innerHTML="",i.appendChild(n),r.classList.remove("is-hidden"))},s.readAsDataURL(a)}}this.remove()})},window.handleCloseEmojiPopupOnEditorClick=function(e){var t=document.getElementById("emoji-palette");t&&("LI"!=e.target.parentElement.tagName&&"UL"!=e.target.parentElement.parentElement.tagName&&t.parentElement.previousElementSibling.querySelector(".ql-emoji").click())},window.enableRatingCardRatingLinks=function(){var e,t=C(document.querySelectorAll('.w-user-rating .dc-user-star-rating-link:not([data-masked-for-tag-interaction-menu="true"])'));try{var n=function(){var t=e.value,n=function(e){e.preventDefault();var n=t.dataset.uuid;if(p(window.websiteUser||null,!0,n,!0,{mode:"popup",idParent:null,className:"popup",triggeredFrom:"tag_rating",gaEventCategory:"tag_rating",showCloseButton:!0})){var i,o=t.dataset.idTag;(i=document.querySelectorAll(".user-rating-input-container:not(.is-hidden)"))&&i.forEach(function(e){var t=e.getAttribute("data-id-tag");t&&window.resetRatingForSubmission(t)}),o&&window.queueRatingForSubmission(o,t)}};t.removeEventListener("click",n),t.addEventListener("click",n)};for(t.s();!(e=t.n()).done;)n()}catch(e){t.e(e)}finally{t.f()}},window.resetRatingForSubmission=function(e){var t,n=C(document.querySelectorAll(".w-user-rating .dc-user-star-rating-link"));try{for(n.s();!(t=n.n()).done;){var i=t.value,o=i.dataset.idTag;if(o==e){window.queueRatingForSubmission(o,i,!0);var a,r=C(document.querySelectorAll(".active-rating-".concat(e,".review-link")));try{for(r.s();!(a=r.n()).done;){a.value.innerText="Leave a Review"}}catch(e){r.e(e)}finally{r.f()}}}}catch(e){n.e(e)}finally{n.f()}},window.enableDisplayCardRatingButtons=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=C(t?t.querySelectorAll(".dc-user-rate"):document.querySelectorAll(".w-user-rating .dc-user-rate"));try{var i=function(){var t=e.value,n=function(){var e=t.id.split("-"),n=e[1];e[3];if(p(window.websiteUser||null,!0,"tag_rating")){t.value;setTimeout(function(){n&&window.queueRatingForSubmission(n,t)},0)}};t.removeEventListener("click",n),t.addEventListener("click",n)};for(n.s();!(e=n.n()).done;)i()}catch(e){n.e(e)}finally{n.f()}var o=document.querySelectorAll(".btn-dc-comment-rate");o&&o.forEach(function(e){var t=function(){p(window.websiteUser||null,!0,"tag_rating")};e.removeEventListener("click",t),e.addEventListener("click",t)})},window.enableRateNowStarButtons=function(){for(var e=document.querySelectorAll('[data-is-skip-rating-button="true"]'),t=0;t<e.length;t++){var n=e[t];n.isAttached||(n.addEventListener("click",function(e){var t=new CustomEvent("vn_ui:rated",{bubbles:!0,detail:{skip:!0}});e.target.dispatchEvent(t)}),n.isAttached=!0)}for(var i=document.querySelectorAll(".dc-user-rate"),o=function(){var e=i[a];if(e.isAttached)return 1;e.addEventListener("click",function(t){var n=t.target.closest('[data-rating-group="true"]'),i=t.target.closest("[data-list-name]"),o=i?i.dataset.listName:null,a={loggedInUser:window.websiteUser||null,idTag:n.dataset.idTag,idRating:n.dataset.idRating,skipPromotion:!!t.target.closest('[data-skip-rating-promotion="true"]'),rating:t.target.value,listName:o};window.hideAllMessages();window.websiteUser;window.submitDisplayCardComment(a,function(t){t&&M(e,t.promotion)});var r=new CustomEvent("vn_ui:rated",{bubbles:!0,detail:a});t.target.dispatchEvent(r)}),e.isAttached=!0},a=0;a<i.length;a++)o();for(var r=document.querySelectorAll(".btn-thread-user-rate"),d=null,s=function(){var e=r[l];if(e.isAttached)return 1;e.addEventListener("click",function(t){if(t.target!==d){var n=t.target.closest('[data-rating-group="true"]'),i=t.target.closest("[data-list-name]"),o=i?i.dataset.listName:null,a={loggedInUser:window.websiteUser||null,idTag:n.dataset.idTag,idRating:n.dataset.idRating,skipPromotion:!!t.target.closest('[data-skip-rating-promotion="true"]'),rating:t.target.value,listName:o};window.hideAllMessages(),window.submitDisplayCardComment(a,function(t){t&&M(e,t.promotion)});var r=new CustomEvent("vn_ui:rated",{bubbles:!0,detail:a});t.target.dispatchEvent(r),d=t.target}}),e.isAttached=!0},l=0;l<r.length;l++)s()},window.removeThreadRatingEventListeners=function(e){document.querySelectorAll(".btn-thread-user-rate").forEach(function(t){var n=e.cloneNode(!0);e.parentNode.replaceChild(n,t)})},window.enableExistingUserRatingButtons=function(){document.querySelectorAll('.rate-cta.user-rating-score:not([data-masked-for-tag-interaction-menu="true"])').forEach(function(e){e.alreadyAttached||(e.addEventListener("click",function(t){t.preventDefault();var n=e.dataset.hubPageUrl;if(e.dataset.idComment)window.location.href=n;else{var i=e.dataset.idTag;i&&window.queueRatingForSubmission(i,e)}}),e.alreadyAttached=!0)});var e=document.getElementById("thread-user-rating-score");if(e){var t=function(e){e.preventDefault(),window.queueThreadRatingForSubmission()};e.removeEventListener("click",t),e.addEventListener("click",t)}},"loading"!==document.readyState?createCommentEventListeners():document.addEventListener("DOMContentLoaded",function(){createCommentEventListeners()},{once:!0});var O=/(\|\@(.{0,255}?)#(\w{2}\w{6})\|)/gi,j=/<span.+?data-id-public="(\w{2}\d{6})".*?>(.{0,255}?)<\/span>/gi,N=/data-id-public="(\w{2}\d{6})"/gi,D=/([A-Za-z]{2}[0-9]{6})/,H=/(.*)\#(\w{2}\d{6})$/gi,U=2;function V(e){return'<span class="mention" data-denotation-char="@" data-index="-1" data-id="'.concat(Date.now(),'" data-value="').concat(e,'"><span class="ql-mention-denotation-char">@</span>').concat(e,"</span>")}function F(e){return'<span data-id-public="'.concat(e.idPublic,'">').concat(e.displayName,"</span>")}function z(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(window.__mentionable_users=window.__mentionable_users||[],window.location.pathname.includes("/reviews"))return[];for(var t=window.__mentionable_users||[],n=0,i=document.querySelectorAll("*[data-user-id-public]"),o="",a=0;a<i.length;a++){var r=i[a].getAttribute("data-user-id-public");if(r&&r.match(D)){var d=i[a].getAttribute("data-user-display-name");i[a].getAttribute("data-user-is-connected")&&(o=r);var s={id:n,value:"".concat(d,"#").concat(r),displayName:d,idPublic:r};n+=1,t.push(s)}}t=t.filter(function(e,t,n){return n.findIndex(function(t){return t.idPublic===e.idPublic})===t});for(var l=0;l<t.length;l++)t[l].idPublic===o&&(t[l].isConnected=!0);return window.__mentionable_users=t,e&&(t=t.filter(function(e,t,n){return!n[t].isConnected})),t}function X(e){var t=e,n=e.match(O);if(n)for(var i=0;i<n.length;i++){var o=n[i],a=O.exec(o);O.lastIndex=0,!a||a.length<4||(t=t.replace(o,V("".concat(a[2],"#").concat(a[3]))))}var r=t.match(j);if(r)for(var d=0;d<r.length;d++){var s=r[d],l=j.exec(s);j.lastIndex=0,!l||l.length<3||(t=t.replace(s,V("".concat(l[2],"#").concat(l[1]))))}return t}function Y(e){var t=e.match(N);if(!t)return!0;if(t=t.filter(function(e,t,n){return n.findIndex(function(t){return t===e})===t}),(t=t.map(function(e){var t=N.exec(e);return N.lastIndex=0,!t||t.length<2?null:t[1]})).length>U)return window.displayErrorMessage("A maxium of 2 users can be mentioned in a single post."),!1;for(var n,i=z(),o=function(e){var n=i.find(function(n){return n.idPublic==t[e]});return n?n.isConnected?(window.displayErrorMessage("Invalid mention"),{v:!1}):void 0:0},a=0;a<t.length;a++)if(0!==(n=o(a))&&n)return n.v;return!0}function J(){[{id:"commentInput",action:function(e){return e.blur()}},{id:"commentTextEditor",action:function(e){return e.style.display="none"}},{id:"commentToolbar",action:function(e){return e.style.display="none"}}].forEach(function(e){var t=e.id,n=e.action,i=document.getElementById(t);i&&n(i)})}if(console.log("%cEvent dispatched : valnet_ui_event:post_load_init","color: green; font-weight: bold;"),window.dispatchEvent(new Event("valnet_ui_event:post_load_init")),window.adsNinja=window.adsNinja||{},window.adsNinja.queue=window.adsNinja.queue||[],window.adsNinja.queue.push(function(){window.adsNinja.queue.push(function(){try{window.adsNinja.monetizeDynamicContent("comments-feed-list",{name:"comments",groupName:"footer"},"init",{countAndIgnore:["first"],ignore:["comments-feed-pagination"]})}catch(e){console.warn(e)}})}),window.isLoggedInDisplayNameToFillValid=function(e){if(!/^[a-zA-Z0-9]([a-zA-Z0-9_-]{0,22}[a-zA-Z0-9])?$/.test(e))return!1;return!["badword1","badword2","badword3"].includes(e.toLowerCase())},window.getCorrespondingDisplayNameBoxIfAny=function(e){if(!e)return null;var t=e.closest(".comments-feed-item")||e.closest(".threads-prompt");if(!t)return null;var n=t.querySelector(".update-display-name-box");return n||null},window.toggleCorrespondingDisplayNameBoxIfAny=function(e){var t=window.getCorrespondingDisplayNameBoxIfAny(e);t&&t.classList.toggle("hidden")},window.getNewDisplayNameValue=function(e){var t=window.getCorrespondingDisplayNameBoxIfAny(e);return t?t.querySelector("input").value.trim():null},!window.__postRatingModalEventBound){var Q=function(e,t){try{var n=e&&e.detail&&e.detail.element?e.detail.element:null;if(!n)return;var i=n.querySelector(".w-promotion-offer");if(!i)return;var o=i.getAttribute("data-promotion-zone");if(!o)return;console.log("%cQuick Rating Promotion popup ".concat(t,"!"),"background: linear-gradient(45deg, #ff6b6b, #4ecdc4); color: white; padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 12px;");try{var a,r="function"==typeof atob?atob(o):o;if(r&&"function"==typeof(null===(a=window)||void 0===a||null===(a=a.websiteSentinel)||void 0===a?void 0:a.sendEvent)){var d=window.isInternalTraffic?"".concat(t," Page 2+"):"".concat(t," Landing Page");window.websiteSentinel.sendEvent("Promotion",r,d)}}catch(e){console.warn("[PostRatingModal] Failed to decode promotion zone",e)}}catch(e){}};window.addEventListener("postRatingModal:open",function(e){Q(e,"Loaded")}),window.addEventListener("postRatingModal:close",function(e){Q(e,"Dismissed")}),window.__postRatingModalEventBound=!0}})();