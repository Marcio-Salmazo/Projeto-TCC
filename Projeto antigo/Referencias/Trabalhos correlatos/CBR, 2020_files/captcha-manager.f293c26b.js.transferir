(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,i(r.key),r)}}function i(e){var i=function(e,i){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,i||"default");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}(e,"string");return"symbol"==t(i)?i:i+""}var n=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.siteKey=e.siteKey,this.action=e.action||"default",this.scriptLoaded=!1,this.init()},(i=[{key:"init",value:function(){var t=this;if(!this.scriptLoaded){var e=document.createElement("script");e.src="https://www.google.com/recaptcha/api.js?render=".concat(this.siteKey),e.async=!0,e.defer=!0,e.onload=function(){t.scriptLoaded=!0,setTimeout(t.hideCaptchaBadge.bind(t),300)},e.onerror=function(){t.scriptLoaded=!1},document.head.appendChild(e)}}},{key:"hideCaptchaBadge",value:function(){var t=document.querySelector(".grecaptcha-badge");t&&(t.style.display="none")}},{key:"execute",value:function(t){var e=this;!1!==this.scriptLoaded&&"undefined"!=typeof grecaptcha?grecaptcha.ready(function(){grecaptcha.execute(e.siteKey).then(function(e){t(e,null)}).catch(function(e){t(null,new Error("test: Captcha execution failed"))})}):t(null,new Error("reCAPTCHA not loaded"))}},{key:"validate",value:function(t,e){fetch("/google-v3-recaptcha/validate/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t}),credentials:"same-origin"}).then(function(t){return t.json()}).then(function(t){return e(t,null)}).catch(function(t){return e(null,t)})}},{key:"verify",value:function(t){var e=this;this.execute(function(i,n){!n&&i?e.validate(i,function(e,n){!n&&e&&e.success?t(i,null):t(null,n)}):t(null,n)})}},{key:"reset",value:function(){"undefined"!=typeof grecaptcha&&grecaptcha&&grecaptcha.reset&&grecaptcha.reset()}}])&&e(t.prototype,i),n&&e(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,i,n}();function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,a(n.key),n)}}function a(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==r(e)?e:e+""}var c=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.siteKey=e.siteKey,this.containerId=e.containerId,this.onSuccess=e.onSuccess||function(){},this.onExpired=e.onExpired||function(){},this.widgetId=null,this.scriptLoaded=!1,this.isRendered=!1,this.isVerified=!1},(e=[{key:"init",value:function(){this.loadScript(),this.show()}},{key:"loadScript",value:function(){var t=this;if(void 0!==window.grecaptcha&&void 0!==window.grecaptcha.render)return this.scriptLoaded=!0,void this.render();var e=document.createElement("script");e.src="https://www.google.com/recaptcha/api.js",e.async=!0,e.defer=!0,e.onload=function(){t.scriptLoaded=!0,t.render()},document.head.appendChild(e)}},{key:"render",value:function(){var t=this,e=document.getElementById(this.containerId);e&&null===this.widgetId&&(e.removeAttribute("hidden"),grecaptcha.ready(function(){t.widgetId=grecaptcha.render(e,{sitekey:t.siteKey,callback:t.onSuccess.bind(t),"expired-callback":function(){this.isVerified=!1,this.onExpired.bind(this)}}),t.isRendered=!0}))}},{key:"show",value:function(){var t=document.getElementById(this.containerId);t&&t.removeAttribute("hidden")}},{key:"reset",value:function(){null!==this.widgetId&&window.grecaptcha&&grecaptcha.reset(this.widgetId),this.isVerified=!1}},{key:"getIsRendered",value:function(){return this.isRendered}},{key:"getIsVerified",value:function(){return this.isVerified}},{key:"verify",value:function(t,e){var i=this;fetch("/verify_google_recaptcha/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t})}).then(function(t){return t.json()}).then(function(t){i.isVerified=t.success,e&&e(t.success)}).catch(function(t){i.isVerified=!1,e&&e(!1)})}}])&&o(t.prototype,e),i&&o(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,l(n.key),n)}}function l(t){var e=function(t,e){if("object"!=u(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==u(e)?e:e+""}var f=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.v3Config=e.v3Config||{},this.v2Config=e.v2Config,this.autoSubmit=e.autoSubmit||!1,this.submitCallback=e.submitCallback,this.handleResponse=e.handleResponse||function(){},this.v3=null,this.v2=null,this.hasSubmitted=!1,this.init()},(e=[{key:"init",value:function(){var t,e=this;!this.v2&&this.v2Config&&(this.v2=new c({siteKey:this.v2Config.siteKey,containerId:this.v2Config.containerId,onSuccess:function(t){e.v2.verify(t,function(t){t||e.handleResponse("red","Captcha verification failed"),e.autoSubmit&&"function"==typeof e.submitCallback&&(e.hasSubmitted=!0,e.submitCallback())})},onExpired:function(){e.handleResponse("red","Captcha is expired!")}})),!this.v3&&null!==(t=this.v3Config)&&void 0!==t&&t.siteKey&&(this.v3=new n({siteKey:this.v3Config.siteKey,action:this.v3Config.action||"default"}))}},{key:"verifyAndSubmit",value:function(){var t,e,i,n=this;if(this.hasSubmitted=!1,null!==(t=this.v2)&&void 0!==t&&t.getIsVerified()&&"function"==typeof this.submitCallback)return this.hasSubmitted=!0,void this.submitCallback();null===(e=this.v2)||void 0===e||!e.getIsRendered()||this.v2.getIsVerified()?this.v3?this.v3.verify(function(t,e){var i;!e&&t?"function"==typeof n.submitCallback&&(n.hasSubmitted=!0,n.submitCallback()):null===(i=n.v2)||void 0===i||i.init()}):null===(i=this.v2)||void 0===i||i.init():this.handleResponse("red","Captcha is required")}}])&&s(t.prototype,e),i&&s(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();window.CaptchaManager=f})();